"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}var Ajax=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"get",value:function(t,e,n){var o=new XMLHttpRequest;o.open("GET",t,!0),o.onreadystatechange=function(){4===o.readyState&&(200===o.status?e(o.responseText):n&&n(o.status,o.statusText))},o.send()}},{key:"post",value:function(t,e,n,o){var i=new XMLHttpRequest;i.open("POST",t,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){4===i.readyState&&(200===i.status?n(i.responseText):o&&o(i.status,i.statusText))};var s=[];for(var r in e)s.push(r+"="+encodeURIComponent(e[r]));i.send(s.join("&"))}},{key:"postMultiPart",value:function(t,e,n,o){var i=new XMLHttpRequest;i.open("POST",t,!0),i.onreadystatechange=function(){4===i.readyState&&(200===i.status?n(i.responseText):o&&o(i.status,i.statusText))},i.send(e)}}]),t}(),Module=function(){function t(e){_classCallCheck(this,t),this.selector=e}return _createClass(t,[{key:"get",value:function(t){return this.container.querySelector(t)}},{key:"getAll",value:function(t){return Array.prototype.slice.call(this.container.querySelectorAll(t))}},{key:"init",value:function(){this.container=document.querySelector(this.selector),this.onComponentsLoading(),this.onBindEvents(),this.onCreate()}},{key:"onCreate",value:function(){}},{key:"onComponentsLoading",value:function(){}},{key:"onBindEvents",value:function(){}}]),t}(),Page=function(){function t(e,n){_classCallCheck(this,t),this.router=n,this.modules=[],this.contentview=e}return _createClass(t,[{key:"registerModule",value:function(t){this.modules.push(t)}},{key:"init",value:function(){}},{key:"loadView",value:function(t){var e=this;Ajax.get("/views/".concat(t,".html"),function(t){e.content=t,e.onContentLoaded()})}},{key:"onContentLoaded",value:function(){this.contentview.innerHTML=this.content,this.modules.forEach(function(t){return t.init()})}}]),t}(),Router=function(){function t(e){_classCallCheck(this,t),this.mainhash=e,this.routes=[],this._contentview=null}return _createClass(t,[{key:"addRoute",value:function(t,e){this.routes.push({hash:t,controller:e})}},{key:"getHash",value:function(){return window.location.hash||this.mainhash}},{key:"compareHash",value:function(t,e){var n=t.hash;if(/\{[a-z]+\}/i.test(n)){var o=n.split("/"),i=e.split("/");for(var s in o)if(/\{[a-z]+\}/i.test(o[s])){var r=o[s].replace(/\{([a-z]+)\}/i,"$1");t._params||(t.params={}),t._params[r]=i[s]}else if(o[s]!==i[s])return!1;return!0}return n===e}},{key:"run",value:function(){var t=this,e=this.routes.filter(function(e){return t.compareHash(e,t.getHash())});0===e.length||(this.activeRoute=e[0],this.page=new this.activeRoute.controller(this._contentview,this),this.page.init())}},{key:"contentview",set:function(t){this._contentview=t}}]),t}(),NotesModel=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"add",value:function(t, e, n, o){Ajax.post("http://pdfstep.zzz.com.ua?action=todo&method=add",{name:t,desc:e,id:n},function(){return o()})}},{key:"getAll",value:function(t,e){Ajax.post("http://pdfstep.zzz.com.ua?action=todo&method=get",{id:t},function(t){var n=JSON.parse(t).data;e(n)})}},{key:"del",value:function(t,e){Ajax.post("http://pdfstep.zzz.com.ua?action=todo&method=delete",{id:t},function(){return e()})}},{key:"getOne",value:function(t,e,n){this.getAll(t,function(t){return t.filter(function(t){return t.id==e}).forEach(function(t){return n(t)})})}}]),t}(),UsersModel=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"add",value:function(t,e){Ajax.post("http://pdfstep.zzz.com.ua?action=user&method=add",{name:t},function(){return e()})}},{key:"getAll",value:function(t){Ajax.get("http://pdfstep.zzz.com.ua?action=user&method=getAll",function(e){var n=JSON.parse(e).data;t(n)})}},{key:"del",value:function(t, e){Ajax.post("http://pdfstep.zzz.com.ua?action=user&method=del",{id:t},function(){return e()})}}]),t}(),NotesController=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass(e,[{key:"init",value:function(){var t=this.router.activeRoute._params.id;this.registerModule(new NotesPageModule(".notesModule",t)),this.loadView("notes")}}]),e}(Page),NotesPageModule=function(t){function e(t, n){var o;return _classCallCheck(this,e),o=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t)),o.user_id=n,o.model=new NotesModel,o}return _inherits(e,t),_createClass(e,[{key:"onComponentsLoading",value:function(){this.form=this.get(".form"),this.list=this.get(".list"),this.formField=this.get("input"),this.formTextarea=this.get("textarea"),this.formBtn=this.get("button")}},{key:"onBindEvents",value:function(){var t=this;this.formBtn.addEventListener("click",function(){return t.addNote()}),this.list.addEventListener("click",function(e){e.target.matches(".delbtn")&&t.delNote(e.target.dataset.id),e.target.matches(".morebtn")&&t.openNote(e.target.dataset.id)})}},{key:"onCreate",value:function(){this.updateView()}},{key:"updateView",value:function(){var t=this;this.model.getAll(this.user_id,function(e){t.list.innerHTML="",e.forEach(function(e){return t.list.appendChild(UserPageModule.createUserBlock(e))})})}},{key:"addNote",value:function(){var t=this,e=this.formField.value,n=this.formTextarea.value;this.model.add(e,n,this.user_id,function(){return t.updateView()})}},{key:"delNote",value:function(t){var e=this;this.model.del(t,function(){return e.updateView()})}},{key:"openNote",value:function(t){window.location.hash="#/notes/details/"+this.user_id+"/"+t}}],[{key:"createUserBlock",value:function(t){var e=document.createElement("div");e.className="listitem",e.innerHTML='<div class="data">'.concat(t.name,"</div>");var n=document.createElement("button");n.dataset.id=t.id,n.innerText="delete",n.className="btn btn-danger delbtn";var o=document.createElement("button");return o.dataset.id=t.id,o.innerText="more",o.className="btn btn-success morebtn",e.appendChild(n),e.appendChild(o),e}}]),e}(Module),NotesDetailsController=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass(e,[{key:"init",value:function(){var t=this.router.activeRoute._params.id,e=this.router.activeRoute._params.userId;this.registerModule(new NoteDetailsPageModule(".detailsModule",t,e)),this.loadView("notes_details")}}]),e}(Page),NoteDetailsPageModule=function(t){function e(t, n, o){var i;return _classCallCheck(this,e),i=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t)),i.userId=o,i.id=n,i.model=new NotesModel,i}return _inherits(e,t),_createClass(e,[{key:"onComponentsLoading",value:function(){this.title=this.get(".title"),this.desc=this.get(".desc")}},{key:"onBindEvents",value:function(){}},{key:"onCreate",value:function(){var t=this;this.model.getOne(this.userId,this.id,function(e){t.title.innerHTML=e.name,t.desc.innerHTML=e.desc})}}]),e}(Module),UsersController=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass(e,[{key:"init",value:function(){this.registerModule(new UserPageModule(".userModule")),this.loadView("users")}}]),e}(Page),UserPageModule=function(t){function e(t){var n;return _classCallCheck(this,e),n=_possibleConstructorReturn(this,_getPrototypeOf(e).call(this,t)),n.model=new UsersModel,n}return _inherits(e,t),_createClass(e,[{key:"onComponentsLoading",value:function(){this.form=this.get(".form"),this.list=this.get(".list"),this.formField=this.get("input"),this.formBtn=this.get("button")}},{key:"onBindEvents",value:function(){var t=this;this.formBtn.addEventListener("click",function(){return t.addUser()}),this.list.addEventListener("click",function(e){e.target.matches(".delbtn")&&t.delUser(e.target.dataset.id),e.target.matches(".morebtn")&&t.openNotes(e.target.dataset.id)})}},{key:"onCreate",value:function(){this.updateView()}},{key:"updateView",value:function(){var t=this;this.model.getAll(function(n){t.list.innerHTML="",n.forEach(function(n){return t.list.appendChild(e.createUserBlock(n))})})}},{key:"addUser",value:function(){var t=this,e=this.formField.value;this.model.add(e,function(){return t.updateView()})}},{key:"delUser",value:function(t){var e=this;this.model.del(t,function(){return e.updateView()})}},{key:"openNotes",value:function(t){window.location.hash="#/notes/"+t}}],[{key:"createUserBlock",value:function(t){var e=document.createElement("div");e.className="listitem",e.innerHTML='<div class="data">'.concat(t.name,"</div>");var n=document.createElement("button");n.dataset.id=t.id,n.innerText="delete",n.className="btn btn-danger delbtn";var o=document.createElement("button");return o.dataset.id=t.id,o.innerText="more",o.className="btn btn-success morebtn",e.appendChild(n),e.appendChild(o),e}}]),e}(Module),App=function(){function t(){_classCallCheck(this,t),this.router=new Router("#/"),this.router.addRoute("#/",UsersController),this.router.addRoute("#/notes/details/{userId}/{id}",NotesDetailsController),this.router.addRoute("#/notes/{id}",NotesController)}return _createClass(t,[{key:"run",value:function(){this.router.contentview=document.querySelector(".contentView"),this.router.run()}},{key:"start",value:function(){var t=this;window.addEventListener("load",function(){return t.run()}),window.addEventListener("hashchange",function(){return t.run()})}}]),t}(),app=new App;app.start();